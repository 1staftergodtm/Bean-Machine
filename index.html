```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Касса Кафе - Система управления</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#8B5CF6',
                        secondary: '#10B981',
                        dark: '#0F172A',
                        darkCard: '#1E293B',
                        darkBg: '#020617',
                        lightText: '#F1F5F9',
                        darkText: '#94A3B8'
                    }
                }
            }
        }
    </script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .btn { transition: all 0.2s ease; }
        .card { border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        body { background-color: #020617; color: #F1F5F9; }
        .dark-bg { background-color: #0F172A; }
        .dark-card { background-color: #1E293B; }
        .dark-input { background-color: #334155; border-color: #475569; color: #F1F5F9; }
        .dark-input::placeholder { color: #94A3B8; }
        .dark-border { border-color: #334155; }
        .editable-title { cursor: pointer; transition: opacity 0.2s; }
        .editable-title:hover { opacity: 0.8; }
    </style>
</head>
<body class="dark min-h-screen">
    <!-- Header -->
    <header class="dark-bg shadow-sm">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
                        <i class="fas fa-coffee text-white text-xl"></i>
                    </div>
                    <h1 id="app-title" class="text-2xl font-bold text-lightText editable-title" onclick="editTitle()">Касса Кафе</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <p class="text-sm darkText">Смена</p>
                        <p id="current-shift" class="font-semibold">Не открыта</p>
                    </div>
                    <button id="shift-btn" class="bg-primary hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium">
                        <i class="fas fa-door-open mr-2"></i>Открыть смену
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <div class="container mx-auto px-4 py-6">
        <div class="flex space-x-1 dark-bg p-1 rounded-lg shadow-sm mb-6">
            <button onclick="switchTab('cashier')" class="tab-btn flex-1 py-2 px-4 rounded-md font-medium darkText hover:text-primary transition-colors">
                <i class="fas fa-cash-register mr-2"></i>Касса
            </button>
            <button onclick="switchTab('menu')" class="tab-btn flex-1 py-2 px-4 rounded-md font-medium darkText hover:text-primary transition-colors">
                <i class="fas fa-utensils mr-2"></i>Меню
            </button>
            <button onclick="switchTab('inventory')" class="tab-btn flex-1 py-2 px-4 rounded-md font-medium darkText hover:text-primary transition-colors">
                <i class="fas fa-box mr-2"></i>Склад
            </button>
            <button onclick="switchTab('staff')" class="tab-btn flex-1 py-2 px-4 rounded-md font-medium darkText hover:text-primary transition-colors">
                <i class="fas fa-users mr-2"></i>Персонал
            </button>
            <button onclick="switchTab('reports')" class="tab-btn flex-1 py-2 px-4 rounded-md font-medium darkText hover:text-primary transition-colors">
                <i class="fas fa-chart-line mr-2"></i>Отчёты
            </button>
        </div>

        <!-- Cashier Tab -->
        <div id="cashier" class="tab-content active">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Menu Items -->
                <div class="lg:col-span-2">
                    <div class="dark-card card p-6">
                        <h2 class="text-xl font-bold mb-4 text-lightText">Меню</h2>
                        <div id="menu-items" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Menu items will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <!-- Order Summary -->
                <div class="dark-card card p-6">
                    <h2 class="text-xl font-bold mb-4 text-lightText">Текущий заказ</h2>
                    <div id="order-items" class="space-y-3 mb-6">
                        <!-- Order items will be loaded here -->
                    </div>
                    <div class="border-t border-gray-600 pt-4">
                        <div class="flex justify-between text-lg font-bold mb-4">
                            <span>Итого:</span>
                            <span id="order-total">0 $</span>
                        </div>
                        <button id="complete-order" class="w-full bg-secondary hover:bg-emerald-600 text-white py-3 rounded-lg font-bold text-lg">
                            <i class="fas fa-check mr-2"></i>Завершить заказ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Menu Management Tab -->
        <div id="menu" class="tab-content">
            <div class="dark-card card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-lightText">Управление меню</h2>
                    <button id="add-menu-item" class="bg-primary hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium">
                        <i class="fas fa-plus mr-2"></i>Добавить блюдо
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-left darkText border-b border-gray-600">
                                <th class="pb-3">Название</th>
                                <th class="pb-3">Цена</th>
                                <th class="pb-3">Ингредиенты</th>
                                <th class="pb-3 text-right">Действия</th>
                            </tr>
                        </thead>
                        <tbody id="menu-table-body">
                            <!-- Menu table rows will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Inventory Tab -->
        <div id="inventory" class="tab-content">
            <div class="dark-card card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-lightText">Склад</h2>
                    <div class="flex space-x-3">
                        <button id="add-inventory-item" class="bg-primary hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium">
                            <i class="fas fa-plus mr-2"></i>Добавить позицию
                        </button>
                        <input type="number" id="portions-input" placeholder="Кол-во порций" class="dark-input rounded-lg px-3 py-2 w-32" value="10">
                        <button id="calculate-ingredients" class="bg-primary hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium">
                            <i class="fas fa-calculator mr-2"></i>Рассчитать
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-left darkText border-b border-gray-600">
                                <th class="pb-3">Ингредиент</th>
                                <th class="pb-3">Ед. изм.</th>
                                <th class="pb-3">Остаток</th>
                                <th class="pb-3">Необходимо</th>
                                <th class="pb-3">Заказать</th>
                                <th class="pb-3 text-right">Действия</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-table-body">
                            <!-- Inventory table rows will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Staff Tab -->
        <div id="staff" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="dark-card card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-lightText">Сотрудники</h2>
                        <button id="add-staff" class="bg-primary hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium">
                            <i class="fas fa-user-plus mr-2"></i>Добавить
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="text-left darkText border-b border-gray-600">
                                    <th class="pb-3">Имя</th>
                                    <th class="pb-3">Должность</th>
                                    <th class="pb-3">Ставка ($/ч)</th>
                                    <th class="pb-3 text-right">Действия</th>
                                </tr>
                            </thead>
                            <tbody id="staff-table-body">
                                <!-- Staff table rows will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="dark-card card p-6">
                    <h2 class="text-xl font-bold mb-6 text-lightText">Активная смена</h2>
                    <div id="active-shift-staff" class="space-y-3">
                        <!-- Active shift staff will be loaded here -->
                    </div>
                    <div class="mt-6">
                        <h3 class="font-bold mb-3 text-lightText">Добавить сотрудника в смену</h3>
                        <select id="staff-select" class="dark-input rounded-lg px-3 py-2 w-full mb-3">
                            <!-- Staff options will be loaded here -->
                        </select>
                        <button id="add-to-shift" class="w-full bg-primary hover:bg-purple-700 text-white py-2 rounded-lg font-medium">
                            <i class="fas fa-user-check mr-2"></i>Добавить в смену
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="dark-card card p-6">
                    <h3 class="text-lg font-bold mb-3 text-lightText">Выручка за день</h3>
                    <div class="text-3xl font-bold text-secondary mb-2" id="daily-revenue">0 $</div>
                    <p class="darkText">Всего заказов: <span id="total-orders">0</span></p>
                </div>
                <div class="dark-card card p-6">
                    <h3 class="text-lg font-bold mb-3 text-lightText">Активная смена</h3>
                    <p id="shift-info" class="darkText">Смена не открыта</p>
                    <div class="mt-4">
                        <h4 class="font-bold mb-2 text-lightText">Сотрудники в смене:</h4>
                        <div id="shift-staff-list" class="space-y-2">
                            <!-- Shift staff list will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="dark-card card p-6">
                <h3 class="text-lg font-bold mb-4 text-lightText">История заказов</h3>
                <div class="mb-4">
                    <input type="text" id="search-orders" placeholder="Поиск по заказам..." class="dark-input rounded-lg px-3 py-2 w-full mb-3">
                    <button id="filter-orders" class="bg-primary hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium">
                        <i class="fas fa-search mr-2"></i>Найти
                    </button>
                </div>
                <div id="orders-history" class="space-y-3 max-h-96 overflow-y-auto">
                    <!-- Order history will be loaded here -->
                </div>
            </div>
            <div class="dark-card card p-6 mt-6">
                <h3 class="text-lg font-bold mb-4 text-lightText">Рабочие смены по дням</h3>
                <div id="shifts-history" class="space-y-4">
                    <!-- Shifts history will be loaded here -->
                </div>
            </div>
            <div class="dark-card card p-6 mt-6">
                <h3 class="text-lg font-bold mb-4 text-lightText">Статистика времени работы сотрудников</h3>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-left darkText border-b border-gray-600">
                                <th class="pb-3">Сотрудник</th>
                                <th class="pb-3">Должность</th>
                                <th class="pb-3">Всего часов</th>
                                <th class="pb-3">Среднее время</th>
                                <th class="pb-3">Заработок ($)</th>
                            </tr>
                        </thead>
                        <tbody id="staff-hours-table">
                            <!-- Staff hours table will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for adding/editing menu items -->
    <div id="menu-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center p-4">
        <div class="dark-card rounded-xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-lightText" id="modal-title">Добавить блюдо</h3>
                <button id="close-modal" class="text-gray-400 hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium darkText mb-1">Название</label>
                    <input type="text" id="modal-dish-name" class="dark-input w-full rounded-lg px-3 py-2" placeholder="Введите название">
                </div>
                <div>
                    <label class="block text-sm font-medium darkText mb-1">Цена ($)</label>
                    <input type="number" id="modal-dish-price" class="dark-input w-full rounded-lg px-3 py-2" placeholder="0">
                </div>
                <div>
                    <label class="block text-sm font-medium darkText mb-1">Ингредиенты (каждый с новой строки)</label>
                    <textarea id="modal-dish-ingredients" class="dark-input w-full rounded-lg px-3 py-2 h-24" placeholder="Кофе: 2 ед.&#10;Молоко: 1 ед.&#10;Сыр: 3 ед."></textarea>
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancel-modal" class="px-4 py-2 border border-gray-600 rounded-lg darkText hover:bg-gray-700">Отмена</button>
                <button id="save-menu-item" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-purple-700">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Modal for adding staff -->
    <div id="staff-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center p-4">
        <div class="dark-card rounded-xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-lightText" id="staff-modal-title">Добавить сотрудника</h3>
                <button id="close-staff-modal" class="text-gray-400 hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium darkText mb-1">Имя</label>
                    <input type="text" id="modal-staff-name" class="dark-input w-full rounded-lg px-3 py-2" placeholder="Введите имя">
                </div>
                <div>
                    <label class="block text-sm font-medium darkText mb-1">Должность</label>
                    <select id="modal-staff-position" class="dark-input w-full rounded-lg px-3 py-2">
                        <option value="Официант">Официант</option>
                        <option value="Бариста">Бариста</option>
                        <option value="Повар">Повар</option>
                        <option value="Администратор">Администратор</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium darkText mb-1">Почасовая ставка ($/ч)</label>
                    <input type="number" id="modal-staff-hourly-rate" class="dark-input w-full rounded-lg px-3 py-2" placeholder="0" value="15">
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancel-staff-modal" class="px-4 py-2 border border-gray-600 rounded-lg darkText hover:bg-gray-700">Отмена</button>
                <button id="save-staff" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-purple-700">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Modal for editing title -->
    <div id="title-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center p-4">
        <div class="dark-card rounded-xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-lightText">Редактировать название</h3>
                <button id="close-title-modal" class="text-gray-400 hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium darkText mb-1">Название системы</label>
                    <input type="text" id="modal-title-input" class="dark-input w-full rounded-lg px-3 py-2" placeholder="Введите название">
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancel-title-modal" class="px-4 py-2 border border-gray-600 rounded-lg darkText hover:bg-gray-700">Отмена</button>
                <button id="save-title" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-purple-700">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Modal for editing inventory -->
    <div id="inventory-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center p-4">
        <div class="dark-card rounded-xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-lightText" id="inventory-modal-title">Редактировать остаток</h3>
                <button id="close-inventory-modal" class="text-gray-400 hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium darkText mb-1">Ингредиент</label>
                    <input type="text" id="modal-inventory-name" class="dark-input w-full rounded-lg px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium darkText mb-1">Единица измерения</label>
                    <input type="text" id="modal-inventory-unit" class="dark-input w-full rounded-lg px-3 py-2" placeholder="ед., кг, л и т.д.">
                </div>
                <div>
                    <label class="block text-sm font-medium darkText mb-1">Текущий остаток</label>
                    <input type="number" id="modal-inventory-stock" class="dark-input w-full rounded-lg px-3 py-2" placeholder="0" step="0.1">
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancel-inventory-modal" class="px-4 py-2 border border-gray-600 rounded-lg darkText hover:bg-gray-700">Отмена</button>
                <button id="save-inventory" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-purple-700">Сохранить</button>
            </div>
        </div>
    </div>

    <script>
        // Mock data - склад изначально по 0
        let menuItems = [
            { id: 1, name: 'Капучино', price: 3.50, ingredients: 'Кофе: 2 ед., Молоко: 1 ед.' },
            { id: 2, name: 'Чизкейк', price: 5.00, ingredients: 'Сыр: 3 ед., Мука: 2 ед., Сахар: 1 ед.' },
            { id: 3, name: 'Салат Цезарь', price: 6.50, ingredients: 'Курица: 2 ед., Салат: 1 ед., Сыр: 1 ед.' },
            { id: 4, name: 'Бургер', price: 8.00, ingredients: 'Мясо: 2 ед., Булка: 1 ед., Сыр: 1 ед.' }
        ];

        let inventory = [
            { id: 1, name: 'Кофе', unit: 'ед.', stock: 0, needed: 0, toOrder: 0 },
            { id: 2, name: 'Молоко', unit: 'ед.', stock: 0, needed: 0, toOrder: 0 },
            { id: 3, name: 'Сыр', unit: 'ед.', stock: 0, needed: 0, toOrder: 0 },
            { id: 4, name: 'Мука', unit: 'ед.', stock: 0, needed: 0, toOrder: 0 },
            { id: 5, name: 'Сахар', unit: 'ед.', stock: 0, needed: 0, toOrder: 0 },
            { id: 6, name: 'Курица', unit: 'ед.', stock: 0, needed: 0, toOrder: 0 },
            { id: 7, name: 'Салат', unit: 'ед.', stock: 0, needed: 0, toOrder: 0 },
            { id: 8, name: 'Мясо', unit: 'ед.', stock: 0, needed: 0, toOrder: 0 },
            { id: 9, name: 'Булка', unit: 'ед.', stock: 0, needed: 0, toOrder: 0 }
        ];

        let staffMembers = [
            { id: 1, name: 'Анна Петрова', position: 'Бариста', hourlyRate: 18 },
            { id: 2, name: 'Иван Сидоров', position: 'Официант', hourlyRate: 16 },
            { id: 3, name: 'Мария Кузнецова', position: 'Повар', hourlyRate: 22 },
            { id: 4, name: 'Дмитрий Иванов', position: 'Администратор', hourlyRate: 25 }
        ];

        let currentOrder = [];
        let shiftOpen = false;
        let shiftStartTime = null;
        let shiftStaff = [];
        let totalRevenue = 0;
        let totalOrders = 0;
        let ordersHistory = [];
        let shiftsHistory = [];

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            renderMenuItems();
            renderMenuTable();
            renderInventoryTable();
            renderStaffTable();
            renderStaffSelect();
            updateOrderSummary();
            
            // Event listeners
            document.getElementById('shift-btn').addEventListener('click', toggleShift);
            document.getElementById('complete-order').addEventListener('click', completeOrder);
            document.getElementById('add-menu-item').addEventListener('click', () => openMenuModal());
            document.getElementById('calculate-ingredients').addEventListener('click', calculateIngredients);
            document.getElementById('close-modal').addEventListener('click', closeModal);
            document.getElementById('cancel-modal').addEventListener('click', closeModal);
            document.getElementById('save-menu-item').addEventListener('click', saveMenuItem);
            document.getElementById('add-staff').addEventListener('click', () => openStaffModal());
            document.getElementById('close-staff-modal').addEventListener('click', closeStaffModal);
            document.getElementById('cancel-staff-modal').addEventListener('click', closeStaffModal);
            document.getElementById('save-staff').addEventListener('click', saveStaff);
            document.getElementById('add-to-shift').addEventListener('click', addToShift);
            document.getElementById('app-title').addEventListener('click', editTitle);
            document.getElementById('close-title-modal').addEventListener('click', closeTitleModal);
            document.getElementById('cancel-title-modal').addEventListener('click', closeTitleModal);
            document.getElementById('save-title').addEventListener('click', saveTitle);
            document.getElementById('close-inventory-modal').addEventListener('click', closeInventoryModal);
            document.getElementById('cancel-inventory-modal').addEventListener('click', closeInventoryModal);
            document.getElementById('save-inventory').addEventListener('click', saveInventory);
            document.getElementById('add-inventory-item').addEventListener('click', () => openInventoryModal());
            document.getElementById('filter-orders').addEventListener('click', filterOrders);
            document.getElementById('search-orders').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') filterOrders();
            });
        });

        // Format currency function
        function formatCurrency(amount) {
            return amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' $';
        }

        // Edit title functionality
        function editTitle() {
            const currentTitle = document.getElementById('app-title').textContent;
            document.getElementById('modal-title-input').value = currentTitle;
            document.getElementById('title-modal').classList.remove('hidden');
        }

        function closeTitleModal() {
            document.getElementById('title-modal').classList.add('hidden');
        }

        function saveTitle() {
            const newTitle = document.getElementById('modal-title-input').value.trim();
            if (newTitle) {
                document.getElementById('app-title').textContent = newTitle;
            }
            closeTitleModal();
        }

        // Tab switching
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('text-primary', 'bg-gray-700');
                btn.classList.add('darkText');
            });
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.remove('darkText');
            document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.add('text-primary', 'bg-gray-700');
            
            if (tabId === 'reports') {
                document.getElementById('daily-revenue').textContent = formatCurrency(totalRevenue);
                document.getElementById('total-orders').textContent = totalOrders;
                renderOrdersHistory();
                renderShiftsHistory();
                renderShiftInfo();
                renderStaffHoursTable();
            } else if (tabId === 'staff') {
                renderActiveShiftStaff();
                renderStaffSelect();
            } else if (tabId === 'inventory') {
                renderInventoryTable();
            }
        }

        // Shift management with precise timing
        function toggleShift() {
            if (!shiftOpen) {
                shiftOpen = true;
                shiftStartTime = new Date();
                shiftStaff = [];
                document.getElementById('current-shift').textContent = 'Открыта';
                document.getElementById('shift-btn').innerHTML = '<i class="fas fa-door-closed mr-2"></i>Закрыть смену';
                document.getElementById('shift-btn').className = 'bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium';
                document.getElementById('shift-info').innerHTML = `Открыта: ${shiftStartTime.toLocaleTimeString()}<br>Дата: ${shiftStartTime.toLocaleDateString()}`;
                renderActiveShiftStaff();
            } else {
                // Save shift to history with detailed timing
                if (shiftStaff.length > 0) {
                    const shiftEnd = new Date();
                    const shiftDuration = (shiftEnd - shiftStartTime) / (1000 * 60 * 60); // in hours
                    
                    // Update each staff member's shift time and calculate salary
                    const staffWithTime = shiftStaff.map(staff => {
                        const duration = shiftDuration;
                        const salary = staff.hourlyRate * duration;
                        return {
                            ...staff,
                            startTime: new Date(shiftStartTime),
                            endTime: new Date(shiftEnd),
                            duration: duration,
                            salary: salary
                        };
                    });
                    
                    shiftsHistory.unshift({
                        id: Date.now(),
                        staff: staffWithTime,
                        startTime: new Date(shiftStartTime),
                        endTime: shiftEnd,
                        duration: shiftDuration,
                        revenue: totalRevenue,
                        orders: totalOrders
                    });
                }
                
                shiftOpen = false;
                shiftStaff = [];
                document.getElementById('current-shift').textContent = 'Не открыта';
                document.getElementById('shift-btn').innerHTML = '<i class="fas fa-door-open mr-2"></i>Открыть смену';
                document.getElementById('shift-btn').className = 'bg-primary hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium';
                document.getElementById('shift-info').textContent = 'Смена не открыта';
                renderActiveShiftStaff();
            }
        }

        // Staff management with timing
        function addToShift() {
            if (!shiftOpen) {
                alert('Сначала откройте смену!');
                return;
            }
            
            const staffId = parseInt(document.getElementById('staff-select').value);
            const staff = staffMembers.find(s => s.id === staffId);
            
            if (staff && !shiftStaff.some(s => s.id === staffId)) {
                // Add staff with start time and hourly rate
                shiftStaff.push({
                    ...staff,
                    shiftStartTime: new Date()
                });
                renderActiveShiftStaff();
                alert(`${staff.name} добавлен в смену!`);
            }
        }

        function removeFromShift(staffId) {
            const staffIndex = shiftStaff.findIndex(staff => staff.id === staffId);
            if (staffIndex !== -1) {
                const staff = shiftStaff[staffIndex];
                const endTime = new Date();
                const duration = (endTime - staff.shiftStartTime) / (1000 * 60 * 60); // in hours
                const salary = staff.hourlyRate * duration;
                
                // Save this staff member's shift time
                const completedShift = {
                    ...staff,
                    startTime: new Date(staff.shiftStartTime),
                    endTime: endTime,
                    duration: duration,
                    salary: salary
                };
                
                // Remove from active shift
                shiftStaff.splice(staffIndex, 1);
                renderActiveShiftStaff();
                
                alert(`${staff.name} удален из смены. Отработал: ${duration.toFixed(1)} ч. Заработок: ${formatCurrency(salary)}`);
            }
        }

        function renderActiveShiftStaff() {
            const container = document.getElementById('active-shift-staff');
            const shiftStaffList = document.getElementById('shift-staff-list');
            
            if (shiftStaff.length === 0) {
                container.innerHTML = '<p class="darkText text-center py-4">Нет сотрудников в смене</p>';
                if (shiftStaffList) {
                    shiftStaffList.innerHTML = '<p class="darkText">Нет сотрудников</p>';
                }
                return;
            }
            
            container.innerHTML = '';
            let html = '';
            
            shiftStaff.forEach(staff => {
                const currentTime = new Date();
                const duration = (currentTime - staff.shiftStartTime) / (1000 * 60 * 60); // in hours
                const durationFormatted = duration.toFixed(1);
                const salary = formatCurrency(staff.hourlyRate * duration);
                
                const staffElement = document.createElement('div');
                staffElement.className = 'flex justify-between items-center p-3 bg-gray-800 rounded-lg';
                staffElement.innerHTML = `
                    <div>
                        <div class="font-medium">${staff.name}</div>
                        <div class="text-sm darkText">${staff.position} | ${staff.hourlyRate} $/ч</div>
                        <div class="text-sm text-secondary">${durationFormatted} ч. | ${salary}</div>
                    </div>
                    <button onclick="removeFromShift(${staff.id})" class="text-red-400 hover:text-red-300">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(staffElement);
                html += `<div class="darkText">${staff.name} (${staff.position}) - ${durationFormatted} ч. (${salary})</div>`;
            });
            
            if (shiftStaffList) {
                shiftStaffList.innerHTML = html;
            }
        }

        // Staff hours reporting with salary calculation
        function renderStaffHoursTable() {
            const tbody = document.getElementById('staff-hours-table');
            tbody.innerHTML = '';
            
            // Calculate total hours and salary for each staff member
            const staffHours = {};
            
            // From completed shifts
            shiftsHistory.forEach(shift => {
                shift.staff.forEach(staff => {
                    if (!staffHours[staff.id]) {
                        staffHours[staff.id] = {
                            id: staff.id,
                            name: staff.name,
                            position: staff.position,
                            hourlyRate: staff.hourlyRate,
                            totalHours: 0,
                            shiftCount: 0,
                            totalSalary: 0
                        };
                    }
                    staffHours[staff.id].totalHours += staff.duration;
                    staffHours[staff.id].shiftCount += 1;
                    staffHours[staff.id].totalSalary += staff.salary || 0;
                });
            });
            
            // From current shift (if any)
            shiftStaff.forEach(staff => {
                const currentTime = new Date();
                const duration = (currentTime - staff.shiftStartTime) / (1000 * 60 * 60);
                if (!staffHours[staff.id]) {
                    staffHours[staff.id] = {
                        id: staff.id,
                        name: staff.name,
                        position: staff.position,
                        hourlyRate: staff.hourlyRate,
                        totalHours: 0,
                        shiftCount: 0,
                        totalSalary: 0
                    };
                }
                staffHours[staff.id].totalHours += duration;
                staffHours[staff.id].shiftCount += 1;
                staffHours[staff.id].totalSalary += staff.hourlyRate * duration;
            });
            
            if (Object.keys(staffHours).length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="5" class="py-3 text-center darkText">Нет данных о работе сотрудников</td>`;
                tbody.appendChild(row);
                return;
            }
            
            // Sort by total hours (descending)
            const sortedStaff = Object.values(staffHours).sort((a, b) => b.totalHours - a.totalHours);
            
            sortedStaff.forEach(staff => {
                const avgTime = staff.totalHours / staff.shiftCount;
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700 hover:bg-gray-800';
                row.innerHTML = `
                    <td class="py-3">${staff.name}</td>
                    <td class="py-3">${staff.position}</td>
                    <td class="py-3 font-bold text-secondary">${staff.totalHours.toFixed(1)} ч.</td>
                    <td class="py-3">${avgTime.toFixed(1)} ч.</td>
                    <td class="py-3 font-bold text-green-400">${formatCurrency(staff.totalSalary)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Menu rendering
        function renderMenuItems() {
            const container = document.getElementById('menu-items');
            container.innerHTML = '';
            
            menuItems.forEach(item => {
                const card = document.createElement('div');
                card.className = 'border border-gray-600 rounded-lg p-4 hover:shadow-lg transition-shadow cursor-pointer dark-card';
                card.innerHTML = `
                    <h3 class="font-bold text-lg mb-2">${item.name}</h3>
                    <p class="darkText text-sm mb-3">${item.ingredients}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xl font-bold text-secondary">${formatCurrency(item.price)}</span>
                        <button onclick="addToOrder(${item.id})" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            <i class="fas fa-plus mr-1"></i>Добавить
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderMenuTable() {
            const tbody = document.getElementById('menu-table-body');
            tbody.innerHTML = '';
            
            menuItems.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700 hover:bg-gray-800';
                row.innerHTML = `
                    <td class="py-3">${item.name}</td>
                    <td class="py-3">${formatCurrency(item.price)}</td>
                    <td class="py-3 text-sm darkText">${item.ingredients}</td>
                    <td class="py-3 text-right">
                        <button onclick="editMenuItem(${item.id})" class="text-blue-400 hover:text-blue-300 mr-3">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteMenuItem(${item.id})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Order management
        function addToOrder(dishId) {
            if (!shiftOpen) {
                alert('Сначала откройте смену!');
                return;
            }
            
            const dish = menuItems.find(item => item.id === dishId);
            if (dish) {
                const existingItem = currentOrder.find(item => item.id === dishId);
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    currentOrder.push({
                        id: dish.id,
                        name: dish.name,
                        price: dish.price,
                        quantity: 1
                    });
                }
                updateOrderSummary();
            }
        }

        function updateOrderSummary() {
            const container = document.getElementById('order-items');
            container.innerHTML = '';
            let total = 0;
            
            currentOrder.forEach(item => {
                total += item.price * item.quantity;
                const itemElement = document.createElement('div');
                itemElement.className = 'flex justify-between items-center p-3 bg-gray-800 rounded-lg';
                itemElement.innerHTML = `
                    <div>
                        <div class="font-medium">${item.name}</div>
                        <div class="text-sm darkText">${item.quantity} × ${formatCurrency(item.price)}</div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="font-bold">${formatCurrency(item.price * item.quantity)}</span>
                        <button onclick="removeFromOrder(${item.id})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                container.appendChild(itemElement);
            });
            
            document.getElementById('order-total').textContent = formatCurrency(total);
        }

        function removeFromOrder(dishId) {
            currentOrder = currentOrder.filter(item => item.id !== dishId);
            updateOrderSummary();
        }

        function completeOrder() {
            if (currentOrder.length === 0) {
                alert('Добавьте товары в заказ!');
                return;
            }
            
            if (!shiftOpen) {
                alert('Смена не открыта!');
                return;
            }
            
            const total = currentOrder.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            totalRevenue += total;
            totalOrders++;
            
            // Save order to history
            const order = {
                id: Date.now(),
                items: [...currentOrder],
                total: total,
                timestamp: new Date().toLocaleString(),
                staff: [...shiftStaff],
                shiftId: shiftsHistory.length > 0 ? shiftsHistory[0].id : null
            };
            ordersHistory.unshift(order);
            
            // Reset current order
            currentOrder = [];
            updateOrderSummary();
            
            // Update inventory (mock)
            updateInventory();
            
            alert('Заказ успешно завершен!');
        }

        // Orders history with search functionality
        function renderOrdersHistory(searchTerm = '') {
            const container = document.getElementById('orders-history');
            container.innerHTML = '';
            
            if (ordersHistory.length === 0) {
                container.innerHTML = '<p class="darkText text-center py-4">Нет завершенных заказов</p>';
                return;
            }
            
            let filteredOrders = ordersHistory;
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredOrders = ordersHistory.filter(order => 
                    order.id.toString().includes(term) ||
                    order.total.toString().includes(term) ||
                    order.items.some(item => item.name.toLowerCase().includes(term)) ||
                    order.staff.some(staff => staff.name.toLowerCase().includes(term))
                );
            }
            
            if (filteredOrders.length === 0) {
                container.innerHTML = '<p class="darkText text-center py-4">Заказы не найдены</p>';
                return;
            }
            
            filteredOrders.slice(0, 20).forEach(order => {
                const staffNames = order.staff.map(s => s.name).join(', ') || 'Нет сотрудников';
                const orderElement = document.createElement('div');
                orderElement.className = 'border border-gray-700 rounded-lg p-4 hover:shadow-sm transition-shadow dark-card';
                orderElement.innerHTML = `
                    <div class="flex justify-between mb-2">
                        <span class="font-bold">Заказ #${order.id}</span>
                        <span class="text-secondary font-bold">${formatCurrency(order.total)}</span>
                    </div>
                    <p class="text-sm darkText mb-2">${order.timestamp}</p>
                    <p class="text-sm darkText mb-2">Сотрудники: ${staffNames}</p>
                    <div class="text-sm mb-2">
                        ${order.items.map(item => `${item.name} × ${item.quantity}`).join(', ')}
                    </div>
                    <div class="text-xs darkText">
                        Смена ID: ${order.shiftId || 'Не указана'}
                    </div>
                `;
                container.appendChild(orderElement);
            });
        }

        function filterOrders() {
            const searchTerm = document.getElementById('search-orders').value.trim();
            renderOrdersHistory(searchTerm);
        }

        // Inventory management with editing capability
        function renderInventoryTable() {
            const tbody = document.getElementById('inventory-table-body');
            tbody.innerHTML = '';
            
            inventory.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700 hover:bg-gray-800';
                row.innerHTML = `
                    <td class="py-3">${item.name}</td>
                    <td class="py-3">${item.unit}</td>
                    <td class="py-3">${item.stock} ${item.unit}</td>
                    <td class="py-3">${item.needed} ${item.unit}</td>
                    <td class="py-3 font-bold ${item.toOrder > 0 ? 'text-red-400' : 'text-green-400'}">
                        ${item.toOrder > 0 ? `${item.toOrder} ${item.unit}` : 'Достаточно'}
                    </td>
                    <td class="py-3 text-right">
                        <button onclick="editInventory(${item.id})" class="text-blue-400 hover:text-blue-300 mr-3">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteInventory(${item.id})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function calculateIngredients() {
            const portions = parseInt(document.getElementById('portions-input').value) || 10;
            const dish = menuItems[0]; // For demo purposes, use first dish
            
            // Reset needed quantities
            inventory.forEach(item => {
                item.needed = 0;
                item.toOrder = 0;
            });
            
            // Calculate needed ingredients for selected portions
            const calculations = [
                { name: 'Кофе', needed: portions * 2 },
                { name: 'Молоко', needed: portions * 1 },
                { name: 'Сыр', needed: portions * 5 },
                { name: 'Мука', needed: portions * 2 },
                { name: 'Сахар', needed: portions * 1 },
                { name: 'Курица', needed: portions * 2 },
                { name: 'Салат', needed: portions * 1 },
                { name: 'Мясо', needed: portions * 2 },
                { name: 'Булка', needed: portions }
            ];
            
            calculations.forEach(calc => {
                const item = inventory.find(i => i.name === calc.name);
                if (item) {
                    item.needed = calc.needed;
                    item.toOrder = Math.max(0, calc.needed - item.stock);
                }
            });
            
            renderInventoryTable();
        }

        function updateInventory() {
            // Mock inventory update based on current order
            currentOrder.forEach(orderItem => {
                const dish = menuItems.find(item => item.id === orderItem.id);
                if (dish) {
                    // Simplified ingredient deduction
                    if (dish.name === 'Капучино') {
                        const coffee = inventory.find(i => i.name === 'Кофе');
                        const milk = inventory.find(i => i.name === 'Молоко');
                        if (coffee) coffee.stock = Math.max(0, coffee.stock - (2 * orderItem.quantity));
                        if (milk) milk.stock = Math.max(0, milk.stock - (1 * orderItem.quantity));
                    } else if (dish.name === 'Чизкейк') {
                        const cheese = inventory.find(i => i.name === 'Сыр');
                        const flour = inventory.find(i => i.name === 'Мука');
                        const sugar = inventory.find(i => i.name === 'Сахар');
                        if (cheese) cheese.stock = Math.max(0, cheese.stock - (3 * orderItem.quantity));
                        if (flour) flour.stock = Math.max(0, flour.stock - (2 * orderItem.quantity));
                        if (sugar) sugar.stock = Math.max(0, sugar.stock - (1 * orderItem.quantity));
                    } else if (dish.name === 'Салат Цезарь') {
                        const chicken = inventory.find(i => i.name === 'Курица');
                        const lettuce = inventory.find(i => i.name === 'Салат');
                        const cheese = inventory.find(i => i.name === 'Сыр');
                        if (chicken) chicken.stock = Math.max(0, chicken.stock - (2 * orderItem.quantity));
                        if (lettuce) lettuce.stock = Math.max(0, lettuce.stock - (1 * orderItem.quantity));
                        if (cheese) cheese.stock = Math.max(0, cheese.stock - (1 * orderItem.quantity));
                    } else if (dish.name === 'Бургер') {
                        const meat = inventory.find(i => i.name === 'Мясо');
                        const bun = inventory.find(i => i.name === 'Булка');
                        const cheese = inventory.find(i => i.name === 'Сыр');
                        if (meat) meat.stock = Math.max(0, meat.stock - (2 * orderItem.quantity));
                        if (bun) bun.stock = Math.max(0, bun.stock - (1 * orderItem.quantity));
                        if (cheese) cheese.stock = Math.max(0, cheese.stock - (1 * orderItem.quantity));
                    }
                }
            });
            renderInventoryTable();
        }

        // Inventory editing and adding
        function openInventoryModal(inventoryId = null) {
            const modal = document.getElementById('inventory-modal');
            const title = document.getElementById('inventory-modal-title');
            const saveBtn = document.getElementById('save-inventory');
            
            if (inventoryId) {
                // Edit mode
                const item = inventory.find(i => i.id === inventoryId);
                document.getElementById('modal-inventory-name').value = item.name;
                document.getElementById('modal-inventory-unit').value = item.unit;
                document.getElementById('modal-inventory-stock').value = item.stock;
                title.textContent = 'Редактировать позицию на складе';
                saveBtn.dataset.editing = inventoryId;
            } else {
                // Add mode
                document.getElementById('modal-inventory-name').value = '';
                document.getElementById('modal-inventory-unit').value = 'ед.';
                document.getElementById('modal-inventory-stock').value = '0';
                title.textContent = 'Добавить позицию на склад';
                saveBtn.removeAttribute('data-editing');
            }
            
            modal.classList.remove('hidden');
        }

        function closeInventoryModal() {
            document.getElementById('inventory-modal').classList.add('hidden');
        }

        function saveInventory() {
            const name = document.getElementById('modal-inventory-name').value.trim();
            const unit = document.getElementById('modal-inventory-unit').value.trim();
            const stock = parseFloat(document.getElementById('modal-inventory-stock').value);
            const editingId = document.getElementById('save-inventory').dataset.editing;
            
            if (!name || !unit) {
                alert('Введите название и единицу измерения!');
                return;
            }
            
            if (isNaN(stock) || stock < 0) {
                alert('Введите корректное значение остатка (неотрицательное число)!');
                return;
            }
            
            if (editingId) {
                // Update existing item
                const index = inventory.findIndex(i => i.id == editingId);
                if (index !== -1) {
                    inventory[index] = { id: parseInt(editingId), name, unit, stock, needed: 0, toOrder: 0 };
                }
            } else {
                // Add new item
                // Check if item with same name already exists
                const existingItem = inventory.find(i => i.name.toLowerCase() === name.toLowerCase());
                if (existingItem) {
                    alert('Ингредиент с таким названием уже существует!');
                    return;
                }
                
                const newId = inventory.length > 0 ? Math.max(...inventory.map(i => i.id)) + 1 : 1;
                inventory.push({ id: newId, name, unit, stock, needed: 0, toOrder: 0 });
            }
            
            renderInventoryTable();
            closeInventoryModal();
            alert(editingId ? 'Позиция успешно обновлена!' : 'Позиция успешно добавлена!');
        }

        function editInventory(inventoryId) {
            openInventoryModal(inventoryId);
        }

        function deleteInventory(inventoryId) {
            if (confirm('Вы уверены, что хотите удалить эту позицию со склада?')) {
                inventory = inventory.filter(item => item.id !== inventoryId);
                renderInventoryTable();
            }
        }

        // Staff management with hourly rate
        function renderStaffTable() {
            const tbody = document.getElementById('staff-table-body');
            tbody.innerHTML = '';
            
            staffMembers.forEach(staff => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700 hover:bg-gray-800';
                row.innerHTML = `
                    <td class="py-3">${staff.name}</td>
                    <td class="py-3">${staff.position}</td>
                    <td class="py-3">${staff.hourlyRate} $/ч</td>
                    <td class="py-3 text-right">
                        <button onclick="editStaff(${staff.id})" class="text-blue-400 hover:text-blue-300 mr-3">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteStaff(${staff.id})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderStaffSelect() {
            const select = document.getElementById('staff-select');
            select.innerHTML = '';
            
            staffMembers.forEach(staff => {
                const option = document.createElement('option');
                option.value = staff.id;
                option.textContent = `${staff.name} (${staff.position}) - ${staff.hourlyRate} $/ч`;
                select.appendChild(option);
            });
        }

        function openStaffModal(staffId = null) {
            const modal = document.getElementById('staff-modal');
            const title = document.getElementById('staff-modal-title');
            const saveBtn = document.getElementById('save-staff');
            
            if (staffId) {
                const staff = staffMembers.find(s => s.id === staffId);
                document.getElementById('modal-staff-name').value = staff.name;
                document.getElementById('modal-staff-position').value = staff.position;
                document.getElementById('modal-staff-hourly-rate').value = staff.hourlyRate;
                title.textContent = 'Редактировать сотрудника';
                saveBtn.dataset.editing = staffId;
            } else {
                document.getElementById('modal-staff-name').value = '';
                document.getElementById('modal-staff-position').value = 'Официант';
                document.getElementById('modal-staff-hourly-rate').value = '15';
                title.textContent = 'Добавить сотрудника';
                saveBtn.removeAttribute('data-editing');
            }
            
            modal.classList.remove('hidden');
        }

        function closeStaffModal() {
            document.getElementById('staff-modal').classList.add('hidden');
        }

        function saveStaff() {
            const name = document.getElementById('modal-staff-name').value.trim();
            const position = document.getElementById('modal-staff-position').value;
            const hourlyRate = parseFloat(document.getElementById('modal-staff-hourly-rate').value);
            
            if (!name) {
                alert('Введите имя сотрудника!');
                return;
            }
            
            if (isNaN(hourlyRate) || hourlyRate <= 0) {
                alert('Введите корректную почасовую ставку (положительное число)!');
                return;
            }
            
            const editingId = document.getElementById('save-staff').dataset.editing;
            
            if (editingId) {
                const index = staffMembers.findIndex(s => s.id == editingId);
                if (index !== -1) {
                    staffMembers[index] = { id: parseInt(editingId), name, position, hourlyRate };
                }
            } else {
                const newId = staffMembers.length > 0 ? Math.max(...staffMembers.map(s => s.id)) + 1 : 1;
                staffMembers.push({ id: newId, name, position, hourlyRate });
            }
            
            renderStaffTable();
            renderStaffSelect();
            closeStaffModal();
        }

        function editStaff(staffId) {
            openStaffModal(staffId);
        }

        function deleteStaff(staffId) {
            if (confirm('Вы уверены, что хотите удалить этого сотрудника?')) {
                staffMembers = staffMembers.filter(staff => staff.id !== staffId);
                // Remove from active shift if present
                shiftStaff = shiftStaff.filter(staff => staff.id !== staffId);
                renderStaffTable();
                renderStaffSelect();
                renderActiveShiftStaff();
            }
        }

        // Shifts history with timing details
        function renderShiftsHistory() {
            const container = document.getElementById('shifts-history');
            container.innerHTML = '';
            
            if (shiftsHistory.length === 0) {
                container.innerHTML = '<p class="darkText text-center py-4">Нет завершенных смен</p>';
                return;
            }
            
            shiftsHistory.slice(0, 5).forEach(shift => {
                const startTime = shift.startTime.toLocaleString();
                const endTime = shift.endTime.toLocaleString();
                const duration = shift.duration.toFixed(1);
                const totalSalary = shift.staff.reduce((sum, staff) => sum + (staff.salary || 0), 0);
                
                const shiftElement = document.createElement('div');
                shiftElement.className = 'border border-gray-700 rounded-lg p-4 hover:shadow-sm transition-shadow dark-card';
                shiftElement.innerHTML = `
                    <div class="flex justify-between mb-3">
                        <span class="font-bold">Смена #${shift.id}</span>
                        <span class="text-secondary font-bold">${formatCurrency(shift.revenue)}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mb-3 text-sm">
                        <div><strong>Начало:</strong> ${startTime}</div>
                        <div><strong>Окончание:</strong> ${endTime}</div>
                        <div><strong>Длительность:</strong> ${duration} ч.</div>
                        <div><strong>Заказов:</strong> ${shift.orders}</div>
                        <div><strong>Заработная плата:</strong> ${formatCurrency(totalSalary)}</div>
                        <div><strong>Прибыль:</strong> ${formatCurrency(shift.revenue - totalSalary)}</div>
                    </div>
                    <div class="mt-3">
                        <strong class="darkText">Сотрудники:</strong>
                        <div class="mt-2 space-y-1">
                            ${shift.staff.map(staff => `
                                <div class="text-sm">
                                    ${staff.name} (${staff.position}) - ${staff.duration.toFixed(1)} ч. (${formatCurrency(staff.salary || 0)})
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                container.appendChild(shiftElement);
            });
        }

        function renderShiftInfo() {
            if (shiftOpen) {
                document.getElementById('shift-info').innerHTML = `
                    Открыта: ${shiftStartTime.toLocaleTimeString()}<br>
                    Дата: ${shiftStartTime.toLocaleDateString()}
                `;
                renderActiveShiftStaff();
            }
        }

        // Menu item management
        function openMenuModal(itemId = null) {
            const modal = document.getElementById('menu-modal');
            const title = document.getElementById('modal-title');
            const saveBtn = document.getElementById('save-menu-item');
            
            if (itemId) {
                const item = menuItems.find(i => i.id === itemId);
                document.getElementById('modal-dish-name').value = item.name;
                document.getElementById('modal-dish-price').value = item.price;
                document.getElementById('modal-dish-ingredients').value = item.ingredients;
                title.textContent = 'Редактировать блюдо';
                saveBtn.dataset.editing = itemId;
            } else {
                document.getElementById('modal-dish-name').value = '';
                document.getElementById('modal-dish-price').value = '';
                document.getElementById('modal-dish-ingredients').value = '';
                title.textContent = 'Добавить блюдо';
                saveBtn.removeAttribute('data-editing');
            }
            
            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('menu-modal').classList.add('hidden');
        }

        function saveMenuItem() {
            const name = document.getElementById('modal-dish-name').value.trim();
            const price = parseFloat(document.getElementById('modal-dish-price').value);
            const ingredients = document.getElementById('modal-dish-ingredients').value.trim();
            
            if (!name || isNaN(price) || price <= 0 || !ingredients) {
                alert('Заполните все поля корректно!');
                return;
            }
            
            const editingId = document.getElementById('save-menu-item').dataset.editing;
            
            if (editingId) {
                const index = menuItems.findIndex(item => item.id == editingId);
                if (index !== -1) {
                    menuItems[index] = { id: parseInt(editingId), name, price, ingredients };
                }
            } else {
                const newId = menuItems.length > 0 ? Math.max(...menuItems.map(i => i.id)) + 1 : 1;
                menuItems.push({ id: newId, name, price, ingredients });
            }
            
            renderMenuItems();
            renderMenuTable();
            closeModal();
        }

        function editMenuItem(itemId) {
            openMenuModal(itemId);
        }

        function deleteMenuItem(itemId) {
            if (confirm('Вы уверены, что хотите удалить это блюдо?')) {
                menuItems = menuItems.filter(item => item.id !== itemId);
                renderMenuItems();
                renderMenuTable();
            }
        }
    </script>
</body>
</html>
```